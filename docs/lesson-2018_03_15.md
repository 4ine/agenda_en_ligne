# Cours du 15/03/2018

### Requête préparée

## Template de requête sql

Au lieu de créer une variable pour stocker le template de requête sql, vous pouvez directement passer votre template à la méthode **prepare()**

Exemple sans création de variable
```php
 $clientSth = $connexion->prepare("insert into clients (nom, prenom, genre, date_de_naissance, email, telephone)
 values (:nom, :prenom, :genre, :date_de_naissance, :email, :telephone)");
}
```
Exemple avec la création d 'une variable
```php
$requeteClient = "insert into clients (nom, prenom, genre, date_de_naissance, email, telephone)
values (:nom, :prenom, :genre, :date_de_naissance, :email, :telephone)";

 $clientSth = $connexion->prepare($requeteClient);
}
```


## Différentes façon lier les paramètres aux noms

Vous pouvez lier vos données aux noms avec les méthodes **bindParam** ou **bindValue**

Exemple

```sql
$requeteClient = "insert into clients (nom, prenom, genre, date_de_naissance, email, telephone)
values (:nom, :prenom, :genre, :date_de_naissance, :email, :telephone)";

 $clientSth = $connexion->prepare($requeteClient);

 $clientSt->binParam('nom', $_POST['nom']);
 $clientSt->binParam('prenom', $_POST['prenom']);
 $clientSt->binParam('genre', $_POST['genre']);
 $clientSt->binParam('date_de_naissance', $_POST['date_de_naissance']);
 $clientSt->binParam('email', $_POST['email']);
 $clientSt->binParam('telephone', $_POST['telephone']);

 $clientSt->execute();
```

Ou vous pouvez passer vos données directement dans la méthode **execute()**. Attention toutes les valeurs seront traitées comme des constantes **PDO::PARAM_STR**(à ne pas utiliser pour des ***limit*** ou ***offset***)

```sql
$requeteClient = "insert into clients (nom, prenom, genre, date_de_naissance, email, telephone)
values (:nom, :prenom, :genre, :date_de_naissance, :email, :telephone)";

 $clientSth = $connexion->prepare($requeteClient);

 $clientSth->execute([
	 'nom' => $_POST['nom'],
	 'prenom' => $_POST['prenom'],
	 'genre' => $_POST['genre'],
	 'date_de_naissance' => $_POST['nomdate_de_naissance'],
	 'email' => $_POST['email'],
	 'telephone' => $_POST['telephone'],
 ]);
```

## Récupérer les lignes d'un jeu d'enregistrement

Lorsque vous faites un **select**, après avoir executé votre requête, vous voudriez récupérer un jeu d'enregistrements, pour cela vous avez la méthode **fetch** ou **fetchAll**

### fetch

La méthode fetch permet de récupérer une ligne d'enregistrement

[doc fetch](http://php.net/manual/fr/pdostatement.fetch.php)

### fetchAll

La méthode fetchAll permet de récupérer un tableau contenant toutes les lignes d'un jeu d'enregistrements

[doc fetchAll](http://php.net/manual/fr/pdostatement.fetchall.php)



## Récupérer les erreurs


## Les plus hors scope du cours

### formulaire

## Mettre à jour l'action du form lors d'une mise à jour

## Ajouter l'information dans les champs text

## Ajouter l'information dans les champs select
