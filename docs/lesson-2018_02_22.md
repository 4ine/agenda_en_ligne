# Cours du 22/02/2018

## Requête préparée

Le code ci-dessous va permettre de récuperer la liste des 5 premiers enregistrements de la table clients avec l'utilisation d'une requête préparée en PDO.

```
$limit = 5;
$offset = 0;
$requeteClient = "select * from clients limit :limit offset :offset";

$clientSth = $connexion->prepare($requeteClient);

$clientSth->bindParam('limit', $limit, \PDO::PARAM_INT);
$clientSth->bindParam('offset', $offset, \PDO::PARAM_INT);

$clientSth->execute();
```

- `prepare()` préparer la requête
- `bindParam()` lie un paramètre à un nom de variable spécifique.
- `execute()` execute la requête préparée






Création de la requête avec des `noms` (:nom, :limit et :offset), on peut aussi remplacer ces noms par des `marqueurs` (?)
### Requête avec des noms
```
$requeteClient = "select * from clients limit where nom like :nom limit :limit offset :offset";
$clientSth = $connexion->prepare($requeteClient);
```
### Requête avec des marqueurs
```
$requeteClient = "select * from clients limit
where nom like ? limit ? offset ?";
$clientSth = $connexion->prepare($requeteClient);
```

## Liaison des variables php aux marqueurs/noms

```
$clientSth->bindValue(':search',  "%" . $search. "%");
$clientSth->bindParam('limit', $limit, \PDO::PARAM_INT);
$clientSth->bindParam('offset', $offset, \PDO::PARAM_INT);
```

## Gestion de la pagination


```
$limit = 5;
$offset = ($page-1)*$limit ;
```

## group_concat

http://sql.sh/fonctions/group_concat

## Les plus hors scope du cours

### Modification de types
Vous pouvez modifier le type d'une variable en la préfixant entre parenthèse du type désiré.
```
$foo = 10;               // $foo est un entier
$bar = (boolean) $foo;   // $bar est un booléen
```

http://php.net/manual/fr/language.types.type-juggling.php


### yoda style
On écrit la constante à la gauche de l'opérateur de comparaison, et le nom de la variable dont la valeur est comparée à la constante à la droite.

```if (true == $test) { ... }```

https://fr.wikipedia.org/wiki/Condition_Yoda
