# Cours du 22/03/2018

## Les triggers
Les triggers (ou déclencheurs) sont des objets de la base de données. Attachés à une table, ils vont déclencher l'exécution d'une instruction, ou d'un bloc d'instructions, lorsqu'une, ou plusieurs lignes sont insérées, supprimées ou modifiées dans la table à laquelle ils sont attachés.

[Doc openClassRooms](https://openclassrooms.com/courses/administrez-vos-bases-de-donnees-avec-mysql/triggers)
### Triggers de validation

```sql
DELIMITER $$
CREATE TRIGGER `insert_client_nom_requis`
	BEFORE INSERT ON `clients` FOR EACH ROW
  BEGIN
	IF NEW.`nom` is null or NEW.`nom`='' THEN
		SIGNAL SQLSTATE VALUE '45000'
			SET MESSAGE_TEXT = 'Le nom est obligatoire';
	END IF;
END;
$$
```

```sql
DELIMITER $$
CREATE TRIGGER `client_update_genre_requis`
	BEFORE UPDATE ON `clients` FOR EACH ROW
  BEGIN
	IF NEW.`genre` is null or NEW.`genre`='' THEN
		SIGNAL SQLSTATE VALUE '45000'
			SET MESSAGE_TEXT = 'le genre est obligatoire.';
	END IF;
END;
$$
show triggers;
drop trigger client_update_genre_invalide;
```

```sql
DELIMITER $$
CREATE TRIGGER `client_update_genre_invalide`
	BEFORE UPDATE ON `clients` FOR EACH ROW
  BEGIN
	IF NEW.`genre` not in(0,1,2,3) THEN
		SIGNAL SQLSTATE VALUE '45000'
			SET MESSAGE_TEXT = 'le genre n est pas valide.';
	END IF;
END;
$$
```

verification emial

```sql
DELIMITER $$
CREATE TRIGGER `insert_client_email_valide`
	BEFORE INSERT ON `clients` FOR EACH ROW
  BEGIN
	IF NEW.`email` not REGEXP '^[A-Z0-9._%-]+@[A-Z0-9.-]+\.[A-Z]{2,4}$' THEN
		SIGNAL SQLSTATE VALUE '45000'
			SET MESSAGE_TEXT = 'L\'email est obligatoire';
	END IF;
END;
$$
```



## Les plus hors scope du cours
