# Cours du 01/03/2018

## Requête préparée : suppression d'un enregistrement
Ci-dessous le code qui va permettre de supprimer l'enregistrement qui a l'`id_client` n° 15 dans la table `clients`

```php
$id = 15;
$requeteSuppClient = "delete from clients where id_client = :id";
$suppressionSth =
$connexion->prepare($requeteSuppClient);
$suppressionSth->bindParam('id', $id, PDO::PARAM_INT);
$suppressionSth->execute();
```
### Décomposition du code
On crée une variable `$requeteSuppClient` qui va contenir le template sql de suppression d'un enregistrement

```php
$requeteSuppClient = "delete from clients where id_client = :id";
```

On passe la variable `requeteSuppClient` à la méthode prépare pour préparer la requête (en cas de succès on récupère un object **PDOStatement**)

```php
$suppressionSth = $connexion->prepare($requeteSuppClient);
```

La méthode bindParam va lier le paramètre `id` (:id) à la variable `$id`. Lors de l'execution de la requête le :id sera remplacé par la valeur de la variable `$id`.
(***delete from clients where id_client = 15*** )

```
$suppressionSth->bindParam('id', $id, PDO::PARAM_INT);
```

### SEC_TO_TIME

En sql `SEC_TO_TIME` permet d'afficher des secondes dans un format **HH:MM:SS**

```sql
SELECT SEC_TO_TIME(length*60) AS durationInTime
 FROM sakila.film;
```
Dans l'exemple ci-dessus, on multiplie les minutes par 60 pour avoir des secondes, ensuite on applique la fonction SEC_TO_TIME qui renverra un resultat comme l'exemple suivant : **01:26:00**.

[docs SEC_TO_TIME](http://sql.sh/fonctions/sec_to_time)

### Intéragir avec plusieurs bases de données

On peut créer des requêtes qui vont permettre de communiquer entre plusieurs bases de données.

Premier exemple, importer des données depuis une table existante sur une autre table.

**Version longue **
```sql
insert into sakila2.country (country_id, country, last_update) select country_id, country, last_update from sakila.country;
```

 **Version courte**
```sql
insert into sakila2.country select * from sakila.country;
```
On peut également faire des jointures, voir l'exemple ci-dessous

```sql
select country, group_concat(ci.city separator ', ') as city from  sakila2.country as co
join sakila.city as ci on ci.country_id = co.country_id
group by country;
```


## Les plus hors scope du cours

### Opérateur Null coalescent

```php
 $foo = null;
 $bar = null;

 $value = $foo ?? $bar ?? 'test';
```
la valeur retournée par la variable value sera `test`

[docs coalescent ](http://php.net/manual/fr/migration70.new-features.php#migration70.new-features.null-coalesce-op)
